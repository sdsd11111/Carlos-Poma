<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contacto | Sastrería Carlos Poma - Alta Costura en Loja</title>

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/images/logo-cuadrado.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/logo-cuadrado.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/logo-cuadrado.png">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="manifest" href="/site.webmanifest">

    <!-- Open Graph (Facebook, WhatsApp, etc.) -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sastreriacarlospoma.com/contacto.html">
    <meta property="og:title" content="Contacto | Sastrería Carlos Poma - Alta Costura en Loja">
    <meta property="og:description"
        content="Contáctanos para asesoría personalizada en sastrería fina. Agenda tu cita en nuestro atelier de Loja, Ecuador. WhatsApp: 098 839 6561">
    <meta property="og:image" content="https://sastreriacarlospoma.com/images/logo-cuadrado.png">
    <meta property="og:site_name" content="Carlos Poma Sastrería">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta property="og:image:type" content="image/png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Contacto | Sastrería Carlos Poma - Alta Costura en Loja">
    <meta name="twitter:description"
        content="Contáctanos para asesoría personalizada en sastrería fina. Agenda tu cita en nuestro atelier de Loja, Ecuador. WhatsApp: 098 839 6561">
    <meta name="twitter:image" content="https://sastreriacarlospoma.com/images/logo-cuadrado.png">

    <!-- Schema.org Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ContactPage",
      "mainEntity": {
        "@type": "LocalBusiness",
        "name": "Carlos Poma Sastrería Alta Costura",
        "image": "https://sastreriacarlospoma.com/images/logo-cuadrado.png",
        "logo": "https://sastreriacarlospoma.com/images/logo-cuadrado.png",
        "telephone": "+593988396561",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Loja",
          "addressRegion": "Loja",
          "addressCountry": "EC"
        }
      }
    }
    </script>

    <!-- Meta Tags adicionales -->
    <meta name="description"
        content="Contáctanos en Sastrería Carlos Poma. Estamos en Loja, Ecuador. WhatsApp: 098 839 6561 | Horario: Lunes a Viernes de 10:30 a 19:00">
    <meta name="keywords"
        content="contacto sastrería, sastre en Loja, alta costura Ecuador, agendar cita sastre, WhatsApp sastrería, dirección sastrería Loja, Carlos Poma contacto">
    <meta name="author" content="Sastrería Carlos Poma">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://sastreriacarlospoma.com/contacto.html">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <!-- Leaflet CSS para el mapa -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />

<body>
    <!-- Header Component -->
    <div id="header-component"></div>

    <main class="main-content">
        <!-- Hero Contacto -->
        <section class="hero contact-hero"
            style="background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('images/sobre-nosotros/Nuestra Historia.jpg') no-repeat center center/cover; background-color: #000;">
            <div class="hero-content">
                <h1>Contacte Nuestro Atelier<br><span class="highlight">en Loja, Ecuador.</span></h1>
                <p class="hero-subtitle">Estamos listos para atender sus consultas y asesorarle en su próximo proyecto
                    de sastrería fina.</p>
                <div class="cta-container">
                    <a href="#contact-form" class="btn-gold">
                        <i class="fas fa-envelope"></i> Enviar Mensaje
                    </a>
                </div>
            </div>
        </section>

        <section class="contact-info">
            <div class="container">
                <p><i class="fas fa-envelope"></i> Email: [Su correo electrónico]</p>
                <p><i class="fas fa-phone-alt"></i> Teléfono: <a href="tel:+593988396561">098 839 6561</a></p>
                <p><i class="fas fa-clock"></i> Horario: Lunes a Viernes de 10:30 a 19:00</p>
                <p><i class="fas fa-clock"></i> Sábados: Solo con cita previa</p>

                <div class="contact-form">
                    <h3>Envíenos un Mensaje</h3>
                    <form id="contact-form">
                        <div class="form-group">
                            <input type="text" id="name" name="name" placeholder="Nombre completo" required>
                        </div>
                        <div class="form-group">
                            <input type="email" id="email" name="email" placeholder="Correo electrónico" required>
                        </div>
                        <div class="form-group">
                            <input type="tel" id="phone" name="phone" placeholder="Teléfono (opcional)">
                        </div>
                        <div class="form-group">
                            <textarea id="message" name="message" rows="5" placeholder="Su mensaje" required></textarea>
                        </div>
                        <button type="submit" class="btn-gold">Enviar Mensaje</button>
                    </form>
                </div>

                <!-- Mapa de Google Maps -->
                <div id="map" class="map-container">
                    <div class="map-placeholder">
                        <p>Mapa de ubicación se cargará aquí</p>
                    </div>
                </div>
            </div>
        </section>
        </div>
    </main>

    <!-- Footer Component -->
    <div id="footer-component"></div>
    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <!-- Mover el script de components.js al final del body -->
    <script src="js/components.js"></script>
    <script>
        // Función para inicializar el mapa
        function initMap() {
            const map = L.map('map').setView([-3.9931, -79.2012], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Añadir marcador
            L.marker([-3.9931, -79.2012]).addTo(map)
                .bindPopup('Carlos Poma Sastrería<br>Loja, Ecuador')
                .openPopup();
        }

        // Función para manejar el envío del formulario
        function setupContactForm() {
            const contactForm = document.getElementById('contact-form');
            if (!contactForm) return;

            contactForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                const submitButton = contactForm.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.textContent;

                try {
                    // Mostrar estado de carga
                    submitButton.disabled = true;
                    submitButton.textContent = 'Enviando...';

                    const formData = new FormData(contactForm);
                    const data = Object.fromEntries(formData.entries());

                    const response = await fetch('/api/send-email', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                    });

                    let result;
                    try {
                        // Intentar parsear la respuesta como JSON
                        const responseText = await response.text();
                        result = responseText ? JSON.parse(responseText) : {};
                    } catch (parseError) {
                        console.error('Error al parsear la respuesta del servidor:', parseError);
                        throw new Error('La respuesta del servidor no es un JSON válido');
                    }

                    if (response.ok) {
                        alert('¡Mensaje enviado con éxito! Nos pondremos en contacto contigo pronto.');
                        contactForm.reset();
                    } else {
                        const errorMessage = result.error || 'Hubo un error al enviar el mensaje. Por favor, inténtalo de nuevo más tarde.';
                        console.error('Error en la respuesta del servidor:', result);
                        alert(errorMessage);
                    }
                } catch (error) {
                    console.error('Error al enviar el formulario:', error);
                    alert('Hubo un error al enviar el mensaje. Por favor, inténtalo de nuevo más tarde.');
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = originalButtonText;
                }
            });
        }

        // Inicializar todo cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function () {
            // Inicializar el mapa
            if (document.getElementById('map')) {
                initMap();
            }

            // Configurar el formulario de contacto
            setupContactForm();

            // Verificar si los componentes se cargaron correctamente
            if (typeof initMenu === 'function') {
                console.log('El menú está listo para usarse');
                initMenu(); // Asegurarse de que el menú se inicialice
            } else {
                console.error('La función initMenu no está disponible');
            }
        });
    </script>
</body>

</html>